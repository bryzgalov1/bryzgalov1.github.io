var G=(i,e,n)=>{if(!e.has(i))throw TypeError("Cannot "+n)};var r=(i,e,n)=>(G(i,e,"read from private field"),n?n.call(i):e.get(i)),f=(i,e,n)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,n)},g=(i,e,n,l)=>(G(i,e,"write to private field"),l?l.call(i,n):e.set(i,n),n);var x=(i,e,n)=>(G(i,e,"access private method"),n);const Q=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}};Q();const h={LIVE:"LIVE",DEAD:"DEAD"},u=(i,e)=>`x${i}-y${e}`,Z=i=>{const{width:e,height:n,cellX:l,cellY:t}=i;let s=l-1,o=l+1;s<0&&(s=e-1),o>=e&&(o=0);let c=t-1,a=t+1;return c<0&&(c=n-1),a>=n&&(a=0),[u(s,c),u(l,c),u(o,c),u(o,t),u(o,a),u(l,a),u(s,a),u(s,t)]};function*ee(i,e,n){let l=[];for(let t=0;t<e;t++)for(let s=0;s<i;s++)l.push([s,t]),l.length===n&&(yield l,l=[]);yield l}const te=i=>new Promise(e=>{const{cellSize:n,width:l,height:t,oldCellMap:s}=i,o={},c=ee(l,t,999),a=()=>{const d=c.next();if(d.done){e({cellSize:n,width:l,height:t,cellMap:o});return}else{const I=d.value;for(let y=0;y<I.length;y++){const N=I[y],[S,B]=N,O=u(S,B),q=Z({width:l,height:t,cellX:S,cellY:B}),K=s[O]?s[O].status:h.DEAD;o[O]={cellId:O,cellX:S,cellY:B,status:K,neighbours:q}}window.setTimeout(()=>{a()},0)}};a()}),ne=(i,e)=>e.reduce((l,t)=>i.cellMap[t].status===h.LIVE?l+1:l,0),_={WAS_BORN:"WAS_BORN",DIED:"DIED",DID_NOT_CHANGE:"DID_NOT_CHANGE"},z=i=>{const{cell:e,newLifeMap:n,prevLifeMap:l,tmpStore:t}=i;if(t[e.cellId])return t[e.cellId];let s=_.DID_NOT_CHANGE;const o=ne(l,e.neighbours);return e.status===h.DEAD&&o===3&&(n.cellMap[e.cellId].status=h.LIVE,s=_.WAS_BORN),e.status===h.LIVE&&(o===2||o===3?s=_.DID_NOT_CHANGE:(n.cellMap[e.cellId].status=h.DEAD,s=_.DIED)),t[e.cellId]=s,s},le=i=>{const{cell:e,newLifeMap:n,prevLifeMap:l,tmpStore:t}=i;let s=!1;const o=z({cell:e,newLifeMap:n,prevLifeMap:l,tmpStore:t});(o==="DIED"||o==="WAS_BORN")&&(s=!0);for(const c of e.neighbours){const a=l.cellMap[c],d=z({cell:a,newLifeMap:n,prevLifeMap:l,tmpStore:t});(d==="DIED"||d==="WAS_BORN")&&(s=!0)}return s};let R={};const se=(i,e)=>{const n={};R={};const l=JSON.parse(JSON.stringify(i)),t=Object.keys(e),s=(()=>t.length>0?t:Object.keys(l.cellMap))();for(const o of s){const c=l.cellMap[o];le({cell:c,newLifeMap:l,prevLifeMap:i,tmpStore:R})&&(n[c.cellId]=!0,c.neighbours.forEach(d=>{n[d]=!0}))}return[l,n]};var m,D;class ie{constructor(){f(this,m,void 0);f(this,D,void 0);g(this,m,{width:0,height:0,cellSize:20,cellMap:{}}),g(this,D,{})}async updateMapSize(e,n,l){const t=r(this,m).cellMap,s=await te({cellSize:l,oldCellMap:t,height:n,width:e});g(this,m,s),g(this,D,{})}setStatus(e,n){const l=r(this,m).cellMap[e];l&&(l.status=n,g(this,D,{}))}toggleCellStatus(e){const n=r(this,m).cellMap[e];if(n){const l=n.status===h.LIVE?h.DEAD:h.LIVE;this.setStatus(e,l)}}get lifeMapData(){return r(this,m)}createNewGeneration(){const[e,n]=se(r(this,m),r(this,D));g(this,m,e),g(this,D,n)}}m=new WeakMap,D=new WeakMap;var E,v,M,b,P,$,j,k,F,T;class oe{constructor(){f(this,b);f(this,$);f(this,k);f(this,E,void 0);f(this,v,[]);f(this,M,void 0);f(this,T,e=>{if(r(this,M)){const l=e.target.getBoundingClientRect(),t=e.clientX-l.left,s=e.clientY-l.top,o=Math.floor(t/(r(this,M)+1)),c=Math.floor(s/(r(this,M)+1));r(this,v).forEach(a=>a(o,c))}});const e=document.getElementById("lifeMap");g(this,E,e)}init(e){r(this,E).innerHTML="",r(this,E).removeEventListener("click",r(this,T)),g(this,M,e.cellSize),x(this,$,j).call(this,e),x(this,k,F).call(this,e),r(this,E).addEventListener("click",r(this,T))}update(e){return new Promise(l=>{const t=r(this,E),s=x(this,b,P),o=Object.values(e.cellMap);function*c(){let I=0;for(const y of o){I++;const N=document.getElementById(y.cellId);if(y.status===h.LIVE&&N===null){const S=s(y.cellX,y.cellY,e.cellSize);t.appendChild(S)}y.status===h.DEAD&&N!==null&&t.removeChild(N),I%100===0&&(yield)}yield}const a=c(),d=()=>{a.next().done?l():window.setTimeout(()=>{d()},0)};d()})}onCellClick(e){r(this,v).push(e)}}E=new WeakMap,v=new WeakMap,M=new WeakMap,b=new WeakSet,P=function(e,n,l){const t=u(e,n),s=e*l+e,o=n*l+n,c=`left: ${s}px;top: ${o}px;width: ${l}px;height: ${l}px;`,a=document.createElement("DIV");return a.className="lifeMap__entity",a.id=t,a.style.cssText=c,a},$=new WeakSet,j=function(e){const{width:n,height:l,cellSize:t}=e,s=n+n*t,o=l+l*t,c="#cdcdcd",a=`width: ${s}px;height: ${o}px;
        background-image: 
        repeating-linear-gradient(to right, transparent, transparent ${t}px, ${c}, ${c} ${t+1}px),
        repeating-linear-gradient(to bottom, transparent, transparent ${t}px, ${c}, ${c} ${t+1}px);`;r(this,E).style.cssText=a},k=new WeakSet,F=function(e){const{width:n,height:l,cellSize:t}=e;for(let s=0;s<l;s++)for(let o=0;o<n;o++){const c=u(o,s);if(e.cellMap[c].status===h.LIVE){const d=x(this,b,P).call(this,o,s,t);r(this,E).appendChild(d)}}},T=new WeakMap;var w;class ce{constructor(){f(this,w,void 0);const e=document.getElementById("spin");g(this,w,e),r(this,w).style.cssText="display: none"}show(){r(this,w).style.cssText="display: block;"}hide(){r(this,w).style.cssText="display: none"}}w=new WeakMap;const p=new ie,C=new oe,L=new ce;C.init(p.lifeMapData);const V=document.getElementById("lifeMapSize");V&&V.addEventListener("submit",async i=>{i.preventDefault();const e=new FormData(V),n=e.get("width"),l=e.get("height"),t=e.get("cellSize");n!==null&&l!==null&&t!==null&&(L.show(),await p.updateMapSize(+n,+l,+t),L.hide(),C.init(p.lifeMapData))});C.onCellClick(async(i,e)=>{const n=u(i,e);p.toggleCellStatus(n),await C.update(p.lifeMapData)});const H=document.getElementById("playNext");H&&H.addEventListener("click",async i=>{p.createNewGeneration(),L.show(),await C.update(p.lifeMapData),L.hide()});function W(i,e){return Math.floor(Math.random()*(e-i+1))+i}const X=document.getElementById("addRandom");X&&X.addEventListener("click",async i=>{const{width:e,height:n}=p.lifeMapData,l=Math.floor(e*n*15/100);for(let t=0;t<l;t++){const s=W(0,e),o=W(0,n),c=u(s,o);p.setStatus(c,h.LIVE)}L.show(),await C.update(p.lifeMapData),L.hide()});let A=!0;async function J(){A||(p.createNewGeneration(),await C.update(p.lifeMapData),window.setTimeout(()=>{J()},150))}const Y=document.getElementById("playRun");Y&&Y.addEventListener("click",i=>{A&&(A=!1,J())});const U=document.getElementById("playStop");U&&U.addEventListener("click",i=>{A=!0});
